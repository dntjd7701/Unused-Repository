### 목차 

1. 화면설명  
2. 용어설명 
3. 환경설정 & 통제 & TRIGGER 
5. 프로세스 
6. 쿼리 
7. 개발 특이 사항 

---
### 매출마감등록(BLG0010)

![[Pasted image 20240320091059.png]]

#### 화면정의 

> 출고내역을 적용하여 매출마감을 하는 메뉴

#### 주요 기능 

	- CRUD
	- 출고적용 
	- 출고일괄적용
	- 환율일괄적용
	- 쪽지전송
	- ONEFFICE 
	- 사이드바 
	- 인포메이션바 
	- 이력정보 

#### 설계서 
http://wiki.duzon.com:8080/pages/viewpage.action?pageId=104238597

#### Work Flow 

출고처리 -> _매출마감_ -> 세금계산서처리 & 전표처리 

#### 특징 
-  직접 등록 불가하며,  '출고적용', '출고일괄적용'을 통해 출고 데이터를 적용받음으로써 마감처리가 가능
- 마감구분이 '건별'일 경우, 별도의 적용 없이 출고처리와 함께 마감처리 이런 데이터에 대한 수정 및 삭제는 출고처리 단계서부터 삭제 후 실행해야한다. 
- 이후 프로세스에 적용된 내역에 대해선 수정 및 삭제가 불가
- 시스템 통제등록의 마감통제일자보다 마감일자가 이전일 경우에는 신규등록, 수정, 삭제 불가 
- 마감수량은 **재고평가 시의 대상이 되는 수량**
#### 단가 

1. 단가 유형에 따라 단가 불러오기 (시스템 통제등록)
2. 직전단가
3. 단가 계산법
4. 과세구분 변경시 부가세, 합계액 재계산
5. 단가구분 변경시 단가, 공급가, 부가세, 합계액 재계산
6. 단가유형 화면 표시 여부
7. 단가유형 변경 시 단가, 금액 재계산
8. 수량은 수량소수점 자리수 따름
9. 원화는 원화소수점 자리수 따름
10. 외화는 외화소수점 자리수 따름
11. 비율은 비율 소수점 자리수 따름
12. 금액은 금액 소수점 자리수 따름
13. 외화는 외화 소수점 자리수 따름
14. 환율은 환율 소수점 자리수 따름
15. 끝전 단수처리는 끝전 단수처리 유형를 따름

#### 수량 
1. 구매/판매 포장단위수량 (특정 수량입력 시 포장단위 수량의 배수에 따라 입력)
2. 재고감소 수불 시 LOT 번호 지정
3. 관리단위 수량 입력시 재고단위 수량 계산

> 관리단위 수량, 재고단위 수량 중, 마감 수량은 **관리단위** 수량을 기준으로 하여 계산한다.

---
### 용어 설명 

| **용어** | **정의**                                                                                              |
| :----: | :-------------------------------------------------------------------------------------------------- |
|   마감   | - 협의의 의미: 내가 판 금액과 고객이 산 금액이 일치하는지 확인<br>- 광의의 의미: 협의의 과정을 통해 최종적으로 해당 금액을 고객으로부터 받기 위해 행하는 전사적인 행동 |

---
### 환경설정 

_SL_CFG(통제정보)_
- 전단계 관리구분 적용 여부에 따라 프로세스 적용 시, 관리구분 적용 
- 전단계 비고(내역) 적용 여부에 따라 프로세스 적용 시, 비고 적용 

_SYSCFG(시스템환경설정)_
- 자동환율관리 옵션 사용 여부에 따라 일자별 자동환율 정보 입력 및 코드피커 전환 (코드피커 <-> 수기 입력)
- 국내외환거래 허용 여부에 따라 국내 외환 거래 허용 여부 결정

_전자결제 
- 결재상신 버튼 여부 
- 결재정보 컬럼 사용 
- 전자결제를 사용할 경우, 결재 상태에 따라 데이터 삭제 제한 

 **통제** 
-  마감일자 이전 일자 수불 메뉴 입력 수정 X 
-  입력통제일자 이전 일자 메뉴 수정 X 
-  일괄 마감시 출고 변경 안됌. 

**트리거**

> LSALECLS 

- 영업마감일 이전 데이터 CUD 불가 (사업장별마감통제/입력통제 LCTRL_MTL 테이블 참고)
- 회계전표 처리 시 UD 불가(DOCU_DT, DOCU_SQ -> 회계처리(매출/수금) 참고)
- 분개생성 시 UD 불가(EX_MENU_DT, EX_MENU_SQ) -> 회계처리(매출/수금) 참고


DELETE: 
	- LSALECLS_D 내역 존재 시 삭제 불가 
	- 세금계산서 처리 시 삭제 불가 (TAX_NB)

UPDATE: 
	- 사업장, 부서, 사원 수정 불가(등록 시 조회조건 사업장, 사원, 부서)

---
### 참고자료 

영업에게-마감이란-무엇이고-무엇에-주의해야-하는가

https://money-one-spoon.tistory.com/entry/%EC%98%81%EC%97%85%EC%97%90%EA%B2%8C-%EB%A7%88%EA%B0%90%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EB%AC%B4%EC%97%87%EC%97%90-%EC%A3%BC%EC%9D%98%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94%EA%B0%80
