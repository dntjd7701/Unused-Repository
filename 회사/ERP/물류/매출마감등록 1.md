---
작성자: 강우성
작성일: 2024-03-21
---
********
### 목차 

1. 화면정의   
2. 주요기능 
3. 환경설정 & 통제 & TRIGGER 
5. 프로세스  
6. Kick Points 
7. Befor/After Process 

---
### 매출마감등록(BLG0010)****

![[Pasted image 20240320091059.png]]

#### 화면정의 

> 출고내역을 적용하여 매출마감을 하는 메뉴

#### 주요 기능 

	- CRUD
	- 출고적용 
	- 출고일괄적용
	- 환율일괄적용
	- 쪽지전송
	- ONEFFICE 
	- 사이드바 
	- 인포메이션바 
	- 이력정보 

#### 설계서 

 [물류_BLG0010_매출마감등록](http://wiki.duzon.com:8080/pages/viewpage.action?pageId=104238597)
 
#### Work Flow 

출고처리 -> _매출마감_ -> 세금계산서처리 & 전표처리 


#### 핵심 테이블 

| 테이블명       | 테이블 정의    |
| ---------- | --------- |
| LSALECLS   | 매출마감등록마스터 |
| LSALECLS_D | 매출마감등디테일  |
| LDELIVER   | 출고등록마스터   |
| LDELIVER_D | 출고등록디테일   |

#### 단가 

1. 단가 유형에 따라 단가 불러오기 (시스템 통제등록)
2. 직전단가
3. 단가 계산법
4. 과세구분 변경시 부가세, 합계액 재계산
5. 단가구분 변경시 단가, 공급가, 부가세, 합계액 재계산
6. 단가유형 화면 표시 여부
7. 단가유형 변경 시 단가, 금액 재계산
8. 수량은 수량소수점 자리수 따름
9. 원화는 원화소수점 자리수 따름
10. 외화는 외화소수점 자리수 따름
11. 비율은 비율 소수점 자리수 따름
12. 금액은 금액 소수점 자리수 따름
13. 외화는 외화 소수점 자리수 따름
14. 환율은 환율 소수점 자리수 따름
15. 끝전 단수처리는 끝전 단수처리 유형를 따름

#### 수량 
1. 구매/판매 포장단위수량 (특정 수량입력 시 포장단위 수량의 배수에 따라 입력)
2. 재고감소 수불 시 LOT 번호 지정
3. 관리단위 수량 입력시 재고단위 수량 계산

> 관리단위 수량, 재고단위 수량 중, 마감 수량은 **관리단위**(LDELIVER_D.SO_QT)수량을 기준으로 하여 계산한다.

---
### 용어 설명 

|  **용어**   | **정의**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| :-------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|    마감     | - 협의의 의미: 내가 판 금액과 고객이 산 금액이 일치하는지 확인<br>- 광의의 의미: 협의의 과정을 통해 최종적으로 해당 금액을 고객으로부터 받기 위해 행하는 전사적인 행동                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|    L/C    | L/C(Letter of Credit) 거래가 신용에 의해 움직일 수 있도록, 은행이 요청에 따라 신용을 보증하기 위해 발행하는 증서.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| LOCAL L/C | 내국신용장, 과거 수출이력 및 실적이 있거나 외국으로부터 수출신용장을 받은 국내의 업체가 수출할 물품을 제조하고나 가공할 때에 들어가는 원자재 or 수출용 완제품을 국내에 원할하게 조달하기 위해 만들어진 제도로 개설을 의뢰한 의뢰자의 신청에 따라 국내 공급업자를 수익자로 지정하여 은행에서 발행해주는 지급활약서. 즉, **내국신용장을 개설하는 이유는, 해외로 수출하는 물품이나 그 물품을 만들 재료를 국내에서 구매하기 위해서** 이며, 원자재 공급자 입장에서 해당 방식의 거래는 내국신용장 매입실적이 수출실적으로 인정되기 때문에 여러 금융혜택 및 세금 혜택을 받을 수 있기 때문이며, 구매자(수출자) 입장에서는 수출용 구매자금 대출 및 무역금융 혜택 및 원자재의 확실한 조달을 보장받을 수 있기에 사용한다.<br>전반적인 프로세스는 다음과 같이 진행된다.<br><br>수출자의 내국신용장 개설(재료 국내 구매를 위해) -> 재료 공급자가 대금 대신 내국신용장을 수령 -> 내국신용장을 은행에 제시하여 매입 신청 및 물품 대금 수령 -> 내국신용장을 매입한 은행은 내국신용장 개설 은행에 내국신용장을 제시하고 대금 수령 -> 내국신용장 개설 은행은 내국신용장 개설을 요청한 수출자에게 요청하여 대금 수령 |
|   구매승인서   | 내국신용장에 의하지 아니하고 국내에서 생산된 물품을 외화획득용 원료 또는 물품으로 구매하는 경우에 외국환은행의 장이 내국신용장에 준하여 발급하는 증서를 말한다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   과세매출    | 상품이나 서비스 등을 제공하고 대가로 받았거나 받을 예정인 금액                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |


---
### 환경설정 

_SL_CFG(통제정보)_
- 전단계 관리구분 적용 여부에 따라 프로세스 적용 시, 관리구분 적용 
- 전단계 비고(내역) 적용 여부에 따라 프로세스 적용 시, 비고 적용 

_SYSCFG(시스템환경설정)_
- 자동환율관리 옵션 사용 여부에 따라 일자별 자동환율 정보 입력 및 코드피커 전환 (코드피커 <-> 수기 입력)
- 국내외환거래 허용 여부에 따라 국내 외환 거래 허용 여부 결정

_전자결제 
- 결재상신 버튼 여부 
- 결재정보 컬럼 사용 
- 전자결제를 사용할 경우, 결재 상태에 따라 데이터 삭제 제한 

 **통제** 
-  마감일자 이전 일자 수불 메뉴 입력 수정 X 
-  입력통제일자 이전 일자 메뉴 수정 X 
-  일괄 마감시 출고 변경 불가. 
-  마감통제일자보다 마감일자가 이전일 경우에는 신규등록, 수정, 삭제 불가 
-  이후 프로세스에 적용된 내역에 대해선 수정 및 삭제가 불가
-  직접 등록 불가 ('출고적용', '출고일괄적용'을 통해 출고 데이터를 적용받음으로써 마감처리가 가능)

**트리거**

> LSALECLS 

-   영업마감일 이전 데이터 CUD 불가 (사업장별마감통제/입력통제 LCTRL_MTL 테이블 참고)
-  회계전표 처리 시 UD 불가(DOCU_DT, DOCU_SQ -> 회계처리(매출/수금) 참고)  
- 분개생성 시 UD 불가(EX_MENU_DT, EX_MENU_SQ) -> 회계처리(매출/수금) 참고



DELETE: 
	- LSALECLS_D 내역 존재 시 삭제 불가 
	- 세금계산서 처리 시 삭제 불가 (TAX_NB)

UPDATE: 
	- 사업장, 부서, 사원 수정 불가(등록 시 조회조건 사업장, 사원, 부서)

---
###  프로세스  

![[Pasted image 20240321110752.png]]

매출마감이란 결과적으로 매출에 대한 내역을 확정하는 단계이며, 이 때 마감된 수량은 **재고평가** 시의 대상이 되는 수량이 된다. 

의미적으로 매출에서의 **마감**이란 최종적으로 **매출에 대한 돈을 고객에게 받기 위한 모든 행동**을 의미하며, 이에 따라 계산서 발행(고객에게 계산서 금액대로 돈을 받아야한다는 증빙이자, 세액 신고를 위한 증빙 자료) 및 전표 발행 (회계 자료를 만들기 위한 근간)을 행한다. 결과적으로 두 프로세스는 모두 이루어져야 한다. 

거래에 대한 금액이 확정되는 것이기 때문에 그 금액에 대하여 엄중하게 처리되어야 하며, 외화 거래일 경우 환율의 변동성을 고려하여 계산되어야 한다. 

금액을 산출함에 있어 A10에서의 마감 단가는 기본적으로 **부가세미포함단가** 로 처리한다. 
 
 마감구분(LDELIVER.PROC_FG)이 '건별'일 경우, 출고와 함께 마감 처리가 된다. 그 외, '일괄' 처리를 원할 경우, 매출마감등록 화면에서 일괄로 적용받아 마감할 수 있으며, 이때 출고건에 대하여 부분 마감이 가능하다. 

마감이 확정된 건에 대해서는 출고처리에서의 변경을 통제하며, 수정을 위해서는 이 후 프로세스의 진행이 없어야 한다. 

마감일자별로 마감을 처리하고, 이 후 프로세스를 통해 해당 일자의 차/대변 거래액과 잔액을 동결시키고 확정함으로써, 다음 일/월 레코드를 신규 생성하여 금일 잔액을 이월잔액란에 기록하는 것으로 과거 일자들의 장부 출력이 가능해지며 일자별 잔액을 합산하여 일수로 나눈 평균금액의 산출이 가능해진다. 

	기업별로 마감을 하는 시기는 상이하다. 

----
### Kick Points 

- 매출마감에 직접 입력을 통한 마감 적용은 허용하지 않는다. 
- 마감구분이 '일괄'인 출고 건을 적용 받을 때 **거래구분, 고객, 과세구분, 단가구분**이 동일한 건에 대해서만 묶어 처리할 수 있다. 
-  출고적용된 값을 마감처리하는 화면으로, 마감구분(LDELIVER.PROC_FG) 가 '건별'일 경우, 출고와 함께 마감 처리가 되며 데이터에 대한 수정 및 삭제는 출고처리 단계서부터 삭제 후 실행해야한다. 그 외, '일괄' 처리를 원할 경우, 매출마감등록 화면에서 일괄로 적용받아 마감할 수 있으며, 이때 출고건에 대하여 부분 마감이 가능하다. 
-  마감시, 사업장/부서/사원에 대하여서는 출고의 데이터를 그대로 따라가는 것이 아닌, 현재 조회조건의 사업장/부서/사원을 따라가며 일괄적용시에는 권한에 따라 데이터를 조회하여 등록한다.
- 거래구분 및 국내외국환거래허용 여부에 따라 외화단가/외화금액 visible 여부 결정 
-

#### 쇼핑몰 
- 출고적용을 통해 적용된 쇼핑몰 관련 데이터의 경우 마감단위수량, 재고단위수량은 수정 불가
- 온라인 쇼핑몰 데이터에 대해여 수정 불가하며 삭제만 가능
- '온라인 쇼핑몰' 데이터일 경우, 동일 온라인 출고내역 건에 한해서만 묶어 마감한다.
- 온라인일 경우 mallCode 없이 shoppingNb를 받으며, 변환하기 시점에 LSHOPPING_SALE_TEMP.SHOPPING_NB -> LSALECLS_D.SH_ORDER_NB로 들어간다.
- 엑셀일 경우, mallCode, shoppingNb, shoppingSq를 받으며, 변환하기 시점에 LSHOPPING_SALE_TEMP.MALL_CODE -> LSALECLS.MALL_CODE, LSHOPPING_SALE_TEMP.SHOPPING_NB -> LSALECLS_D.SHOPPING_NB, LSHOPPING_SALE_TEMP.SHOPPING_SQ -> LSALECLS_D.SHOPPING_SQ로 들어간다.

#### 재계산 
- 출고적용 다이얼로그 조회 시, 미마감수량(출고수량 - 마감수량)에 대하여 금액을 재계산한다. 
- 출고 적용 받은 데이터에 대하여 마감 수량을 조정할 경우, 그 마감 수량에 대한 금액이 재계산 되어지며 부분 마감처리 된다.
- 출고 적용 시점에는 데이터의 수정 혹은 부분 마감 건이 아닌 경우 재계산은 하지 않는다.
- 'Domestic' 국내 & 외환거래일 경우 단가/공급가/부가세/합계액 수정시 외화단가 외화금액 자동계산 
- 외화일 경우 단가/공급가/부가세/합계액 수정시 외화단가, 외화금액 자동계산 방지 (거래구분 상관 X)

#### 금액 관련 
- 금액을 산출함에 있어 A10에서의 마감 단가는 기본적으로 **부가세미포함단가** 로 처리한다. 
-  국내, 원화일 경우 외화 수정 불가 
 - 국내외국환거래 허용일 경우, 상태값에 따라 금액 관련 모든 컬럼 수정 가능
 - 물류공통환경설정 사원별단가통제설정에 따라 단가 수정 가능 여부 

#### 그리드 수정 불가 조건 
- 마스터
	1. 마감구분이 '건별'일 경우(PROC_FG = '0') 수정 삭제 불가 
	2. 전표상태가 '미발행' 이외일 경우  수정 삭제 불가 
	3. 전자결재가 이루어졌을 경우 수정 불가  수정 삭제 불가 
	4. 세금계산서 처리 시 수정 삭제 불가 
	5. 거래구분이 DOMESTIC이 아닌 경우 '과세구분' 수정 불가 
- 디테일
	1. 마스터 수정 불가 시 
	2. 전단계 적용일 경우 프로젝트 수정 불가 
	3. 온라인쇼핑몰 적용 시 수량 수정 불가 
	


--- 
### Befor/After Process 

 **이후 프로세스**

- [[회계처리(매출&수금)]]
- 매출전자세금계산서처리

**이전 프로세스**

- 출고등록